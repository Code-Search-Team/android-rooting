
// https://paper.seebug.org/1165/

0x01 익스플로잇 과정
커널 취약점이 srv2.sys 드라이버에서 발견된다. 이유는 SMB가 적절하게 압출된 데이타 패킷을 처리하지 못하기 때문으로,
함수 Srv2DecompressData가 데이터 패킷들의 압축해제를 처리할 시 호출된다.
압축된 데이터 헤더의 압축된 데이터 크기는 OriginalCompressedSegmentSize와 Offset인데,
이것은 법적으로 체크되지 않는다, 그 결과 많은 량의 작은 메모리 하나가 추가 되는 결과를 낳았다.
SmbCompressionDecompress는 데이터 프로세스의 후반부에 사용될 수 있었다.
이 작은 조각의 메모리를 이용하면 out-of-bounds 접근이나 오버플로우를 카피할 수 있다.
로컬 프로그램이 실행될 때, 당신은 그 토큰 + 0x40 현재 오프셋 주소를 얻고, 로컬 프로그램은 SMB 서버에 압축된 데이터를
전달했다. 그 다음, 오프셋 주소는 커널 메모리를 압축 해제된 상태로 복사한다, 그리고 토큰은 커널을 거쳐서 조심스럽게 
메모리 레이아웃에 포함되어 퍼미션들로 구성되어 수정되었다.

